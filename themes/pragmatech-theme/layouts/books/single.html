{{ define "main" }}
<article class="bg-slate-900">
    <div class="max-w-5xl mx-auto px-4 py-8">
        <div class="mb-8">
            <a href="/books/" class="text-brand-400 hover:text-brand-300 flex items-center">
                <i class="fas fa-arrow-left mr-2"></i>
                Back to Books
            </a>
        </div>

        <!-- Book Header Section -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-20">
            <!-- Book Cover Image -->
            <div class="md:col-span-1">
                {{ if .Params.cover_image }}
                {{ $imgData := dict "src" .Params.cover_image "alt" .Title "class" "w-full rounded-lg shadow-md" }}
                {{ partial "picture.html" $imgData }}
                {{ else }}
                <div class="w-full h-96 bg-gradient-to-r from-brand-600 to-brand-500 flex items-center justify-center rounded-lg shadow-md">
                    <span class="text-white text-2xl font-bold p-8 text-center">{{ .Title }}</span>
                </div>
                {{ end }}

                <!-- Purchase Options -->
                <div class="mt-8 bg-slate-800 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-xl font-bold mb-4 text-white">Get This Book</h3>
                    {{ if .Params.price }}
                    <div class="text-3xl font-bold text-brand-400 mb-4">{{ .Params.price }}</div>
                    {{ end }}
                    <a href="{{ .Params.purchase_url | default "#" }}" class="block w-full bg-brand-600 text-white hover:bg-brand-500 font-bold py-3 px-6 rounded-lg transition-colors text-center mb-4">
                    Purchase Now
                    </a>

                    {{ if .Params.sample_url }}
                    <a href="{{ .Params.sample_url }}" class="block w-full bg-transparent border border-brand-500 text-brand-400 hover:bg-brand-500/10 font-bold py-3 px-6 rounded-lg transition-colors text-center mb-4">
                        Download Sample
                    </a>
                    {{ end }}

                    <div class="text-sm text-slate-400 mb-6">
                        {{ .Params.purchase_note | default "Instant download available after purchase." }}
                    </div>

                    <h4 class="font-bold mb-2 text-white">Available formats:</h4>
                    <div class="flex flex-wrap gap-2 mb-6">
                        {{ range .Params.formats }}
                        <span class="inline-block px-3 py-1 bg-slate-700 text-slate-300 rounded-full text-sm">{{ . }}</span>
                        {{ end }}
                    </div>
                </div>
            </div>

            <!-- Book Details -->
            <div class="md:col-span-2">
                <h1 class="text-4xl font-bold mb-4 text-white">{{ .Title }}</h1>
                {{ if .Params.subtitle }}
                <p class="text-xl text-slate-400 mb-6">{{ .Params.subtitle }}</p>
                {{ end }}

                <div class="flex items-center mb-6 flex-wrap gap-4">
                    {{ if .Params.authors }}
                    <div class="flex items-center">
                        <i class="fas fa-user text-slate-500 mr-2"></i>
                        <span class="text-slate-300">
                            {{ delimit .Params.authors ", " " & " }}
                        </span>
                    </div>
                    {{ end }}

                    {{ if .Params.published_date }}
                    <div class="flex items-center">
                        <i class="fas fa-calendar text-slate-500 mr-2"></i>
                        <span class="text-slate-300">Published {{ .Params.published_date }}</span>
                    </div>
                    {{ end }}

                    {{ if .Params.pages }}
                    <div class="flex items-center">
                        <i class="fas fa-file-alt text-slate-500 mr-2"></i>
                        <span class="text-slate-300">{{ .Params.pages }} pages</span>
                    </div>
                    {{ end }}
                </div>

                <div class="prose prose-invert prose-lg max-w-none page-content mb-8 text-slate-300">
                    {{ .Content }}
                </div>

                <!-- What You'll Learn -->
                {{ if .Params.topics }}
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 text-white">What You'll Learn</h2>
                    <ul class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {{ range .Params.topics }}
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-brand-400 mr-3 mt-1"></i>
                            <span class="text-slate-300">{{ . }}</span>
                        </li>
                        {{ end }}
                    </ul>
                </div>
                {{ end }}

                <!-- Table of Contents -->
                {{ if .Params.toc }}
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 text-white">Table of Contents</h2>
                    <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
                        <ul class="space-y-2">
                            {{ range .Params.toc }}
                            <li>
                                <strong class="text-white">{{ .chapter }}</strong>
                                {{ if .sections }}
                                <ul class="pl-6 mt-2 space-y-1">
                                    {{ range .sections }}
                                    <li class="text-slate-400">{{ . }}</li>
                                    {{ end }}
                                </ul>
                                {{ end }}
                            </li>
                            {{ end }}
                        </ul>
                    </div>
                </div>
                {{ end }}
            </div>
        </div>

        <!-- Author Section -->
        {{ if .Params.author_bio }}
        <div class="mb-16">
            <h2 class="text-2xl font-bold mb-6 text-white">About the {{ if gt (len .Params.authors) 1 }}Authors{{ else }}Author{{ end }}</h2>
            <div class="bg-slate-800 rounded-lg p-6 border border-slate-700 text-slate-300">
                {{ .Params.author_bio | markdownify }}
            </div>
        </div>
        {{ end }}

        <!-- Reader Testimonials -->
        {{ if .Params.testimonials }}
        <div class="mb-16">
            <h2 class="text-2xl font-bold mb-6 text-white">Reader Feedback</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {{ range .Params.testimonials }}
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
                    <blockquote class="text-slate-300 mb-4">
                        "{{ .quote }}"
                    </blockquote>
                    <div class="font-medium text-white">{{ .name }}</div>
                    <div class="text-slate-500 text-sm">{{ .role }}, {{ .company }}</div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}

        <!-- FAQ Section -->
        {{ if .Params.faqs }}
        <div class="mb-16">
            <h2 class="text-2xl font-bold mb-6 text-white">Frequently Asked Questions</h2>
            <div class="space-y-4">
                {{ range .Params.faqs }}
                <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
                    <h3 class="text-xl font-bold mb-2 text-white">{{ .question }}</h3>
                    <div class="text-slate-300">{{ .answer }}</div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}

        <!-- Related Books -->
        {{ $currentBook := . }}
        {{ $relatedBooks := where (where .Site.RegularPages "Section" "books") "Permalink" "ne" .Permalink | first 3 }}
        {{ if $relatedBooks }}
        <div class="mt-16 pt-8 border-t border-slate-700">
            <h2 class="text-2xl font-bold mb-6 text-white">You May Also Like</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                {{ range $relatedBooks }}
                <div class="bg-slate-800 rounded-lg border border-slate-700 overflow-hidden hover:border-brand-500/50 transition-colors">
                    {{ if .Params.cover_image }}
                    <div class="p-4">
                        {{ $imgData := dict "src" .Params.cover_image "alt" .Title "class" "w-full h-40 object-contain" }}
                        {{ partial "picture.html" $imgData }}
                    </div>
                    {{ else }}
                    <div class="w-full h-48 bg-slate-700 flex items-center justify-center">
                        <span class="text-slate-400 text-xl font-bold">{{ .Title }}</span>
                    </div>
                    {{ end }}
                    <div class="p-4">
                        <h3 class="font-bold mb-2 text-white">
                            <a href="{{ .Permalink }}" class="hover:text-brand-400 transition-colors">{{ .Title }}</a>
                        </h3>
                        <div class="text-sm text-slate-400 mb-2">
                            {{ with .Params.format }}{{ . }}{{ end }}
                            {{ if and .Params.format .Params.price }} · {{ end }}
                            {{ with .Params.price }}{{ . }}{{ end }}
                        </div>
                        <a href="{{ .Permalink }}" class="text-brand-400 text-sm hover:text-brand-300">View details →</a>
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>
</article>
{{ end }}
