<div class="events-calendar bg-slate-800 rounded-lg border border-slate-700 p-6 mb-12">
  <div class="flex justify-between items-center mb-6">
    <button id="prev-month" class="p-2 rounded-full hover:bg-slate-700 text-slate-400 hover:text-brand-400 transition duration-150">
      <i class="fas fa-chevron-left text-lg"></i>
    </button>
    <h3 id="current-month" class="text-xl font-bold text-white"></h3>
    <button id="next-month" class="p-2 rounded-full hover:bg-slate-700 text-slate-400 hover:text-brand-400 transition duration-150">
      <i class="fas fa-chevron-right text-lg"></i>
    </button>
  </div>

  <div class="grid grid-cols-7 gap-2 text-center mb-4">
    <div class="font-semibold text-slate-300">Mon</div>
    <div class="font-semibold text-slate-300">Tue</div>
    <div class="font-semibold text-slate-300">Wed</div>
    <div class="font-semibold text-slate-300">Thu</div>
    <div class="font-semibold text-slate-300">Fri</div>
    <div class="font-semibold text-slate-300">Sat</div>
    <div class="font-semibold text-slate-300">Sun</div>
  </div>

  <div id="calendar-days" class="grid grid-cols-7 gap-2"></div>

  <div class="mt-6 flex flex-wrap gap-4 text-sm text-slate-300">
    <div class="flex items-center">
      <span class="w-3 h-3 rounded-full bg-yellow-500 mr-2"></span>
      <span>Meetups</span>
    </div>
    <div class="flex items-center">
      <span class="w-3 h-3 rounded-full bg-brand-500 mr-2"></span>
      <span>Talks</span>
    </div>
    <div class="flex items-center">
      <span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>
      <span>Workshops</span>
    </div>
  </div>

  <div class="mt-6 flex flex-wrap text-slate-400">
    <p>Check back regularly for new events or <a class="font-bold text-brand-400 hover:text-brand-300 transition-colors" href="{{ .Site.Params.newsletterUrl }}">subscribe to our newsletter</a> to stay updated.</p>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const events = [
      {{ $eventPages := where .Site.RegularPages "Section" "events" }}
      {{ range $index, $page := $eventPages }}
        {
          date: "{{ time.Format "2006-01-02" $page.Params.startDate }}",
          title: {{ $page.Title  }},
          url: "{{ $page.Permalink }}",
          type: "{{ $page.Params.eventType }}"
        }{{ if ne (add $index 1) (len $eventPages) }},{{ end }}
      {{ end }}
    ];

    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();

    function renderCalendar() {
      const monthElement = document.getElementById('current-month');
      monthElement.textContent = new Date(currentYear, currentMonth, 1).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

      const daysContainer = document.getElementById('calendar-days');
      daysContainer.innerHTML = '';

      // Get first day of month and adjust for Monday start (0 = Monday, 6 = Sunday)
      let firstDay = new Date(currentYear, currentMonth, 1).getDay();
      // Convert from Sunday-first (0-6) to Monday-first (0-6)
      firstDay = firstDay === 0 ? 6 : firstDay - 1;

      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

      // Check if today is in this month
      const today = new Date();
      const isCurrentMonth = today.getMonth() === currentMonth && today.getFullYear() === currentYear;
      const todayDate = today.getDate();

      // Add empty cells for days before the first day of month
      for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'h-16 bg-slate-900/50 rounded';
        daysContainer.appendChild(emptyDay);
      }

      // Add cells for each day
      for (let day = 1; day <= daysInMonth; day++) {
        const dayCell = document.createElement('div');
        const isToday = isCurrentMonth && day === todayDate;

        // Base styling for all day cells - dark theme
        dayCell.className = 'relative h-16 bg-slate-900 border border-slate-700 hover:border-brand-500/50 rounded flex flex-col p-1 transition duration-150';

        // Highlight today's date
        if (isToday) {
          dayCell.classList.add('border-2', 'border-brand-500', 'bg-brand-500/10');
        }

        // Add day number with improved styling
        const dayNumber = document.createElement('div');
        dayNumber.className = isToday ? 'text-sm font-bold text-brand-400' : 'text-sm font-medium text-slate-300';
        dayNumber.textContent = day;
        dayCell.appendChild(dayNumber);

        // Check if there are events on this day
        const dayStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayEvents = events.filter(event => {
          const match = event.date === dayStr;
          return match;
        });

        if (dayEvents.length > 0) {
          // Show indicators for each event type
          const eventsContainer = document.createElement('div');
          eventsContainer.className = 'flex flex-col gap-1 mt-1 overflow-hidden';

          // Create event indicators with colors by type
          dayEvents.slice(0, 2).forEach(event => {
            const eventDot = document.createElement('a');
            eventDot.href = event.url;
            eventDot.title = event.title;

            // Style based on event type
            const bgColor = event.type === 'meetup' ? 'bg-yellow-500' :
                            event.type === 'talk' ? 'bg-brand-500' :
                            'bg-green-500';

            eventDot.className = `text-xs truncate flex items-center hover:underline text-slate-300`;

            const dot = document.createElement('span');
            dot.className = `w-2 h-2 rounded-full ${bgColor} mr-1 flex-shrink-0`;
            eventDot.appendChild(dot);

            const text = document.createElement('span');
            text.className = 'truncate';
            text.textContent = event.title;
            eventDot.appendChild(text);

            eventsContainer.appendChild(eventDot);
          });

          if (dayEvents.length > 2) {
            const moreEvents = document.createElement('div');
            moreEvents.className = 'text-xs text-slate-500 flex items-center';

            const moreText = document.createElement('span');
            moreText.textContent = `+${dayEvents.length - 2} more`;
            moreEvents.appendChild(moreText);

            eventsContainer.appendChild(moreEvents);
          }

          dayCell.appendChild(eventsContainer);
        }

        daysContainer.appendChild(dayCell);
      }
    }

    // Initialize calendar
    renderCalendar();

    // Set up month navigation
    document.getElementById('prev-month').addEventListener('click', function() {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar();
    });

    document.getElementById('next-month').addEventListener('click', function() {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    });
  });
</script>
